<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/> 

	<script src="js/RGraph.common.core.js"></script>

	<script src="js/RGraph.common.annotate.js"></script>  <!-- Just needed for annotating -->
	<script src="js/RGraph.common.context.js"></script>   <!-- Just needed for context menus -->
	<script src="js/RGraph.common.effects.js"></script>   <!-- Just needed for visual effects -->
	<script src="js/RGraph.common.resizing.js"></script>  <!-- Just needed for resizing -->
	<script src="js/RGraph.common.tooltips.js"></script>  <!-- Just needed for tooltips -->
	<script src="js/RGraph.common.zoom.js"></script>      <!-- Just needed for zoom -->
	<script src="js/RGraph.common.dynamic.js"></script>      <!-- Just needed for zoom -->

	<script src="js/RGraph.bar.js"></script>              <!-- Just needed for bar charts -->
	<script src="js/RGraph.bipolar.js"></script>          <!-- Just needed for bi-polar charts -->
	<script src="js/RGraph.fuel.js"></script>             <!-- Just needed for fuel charts -->
	<script src="js/RGraph.funnel.js"></script>           <!-- Just needed for funnel charts -->
	<script src="js/RGraph.gantt.js"></script>            <!-- Just needed for gantt charts -->
	<script src="js/RGraph.gauge.js"></script>            <!-- Just needed for gauge charts -->
	<script src="js/RGraph.hbar.js"></script>             <!-- Just needed for horizontal bar charts -->
	<script src="js/RGraph.hprogress.js"></script>        <!-- Just needed for horizontal progress bars -->
	<script src="js/RGraph.led.js"></script>              <!-- Just needed for LED charts -->
	<script src="js/RGraph.line.js"></script>             <!-- Just needed for line charts -->
	<script src="js/RGraph.meter.js"></script>            <!-- Just needed for meter charts -->
	<script src="js/RGraph.odo.js"></script>              <!-- Just needed for odometers -->
	<script src="js/RGraph.pie.js"></script>              <!-- Just needed for pie AND donut charts -->
	<script src="js/RGraph.radar.js"></script>            <!-- Just needed for radar charts -->
	<script src="js/RGraph.rose.js"></script>             <!-- Just needed for rose charts -->
	<script src="js/RGraph.rscatter.js"></script>         <!-- Just needed for rscatter charts -->
	<script src="js/RGraph.scatter.js"></script>          <!-- Just needed for scatter charts -->
	<script src="js/RGraph.thermometer.js"></script>      <!-- Just needed for thermometer charts -->
	<script src="js/RGraph.vprogress.js"></script>        <!-- Just needed for vertical progress bars -->
	<script src="js/RGraph.waterfall.js"></script>        <!-- Just needed for waterfall charts  -->
</head>

<body>

	<div>
		<div style="margin-left:30%">
			<canvas id="roll" width="600" height="250">[No canvas support]</canvas><br />
			<span style="margin-left: 25px">
				Number of updates: <span id="num_updates1">0</span>
			</span>
		</div>
		<br>
		<div style="margin-left:30%">
			<canvas id="speed" width="600" height="250">[No canvas support]</canvas><br />
			<span style="margin-left: 25px">
				Number of updates: <span id="num_updates2">0</span>
			</span>
		</div>
		<br>
		<div style="margin-left:30%">
			<canvas id="AOA" width="600" height="250">[No canvas support]</canvas><br />
			<span style="margin-left: 25px">
				Number of updates: <span id="num_updates3">0</span>
			</span>
		</div>

		<div style="text-align:center;position:absolute;bottom:20px;left:10px;">
			<canvas id="speed_gauge" width="220" height="220" style="text-align: center">[No canvas support]</canvas>
		</div>
		<div style="text-align:center;position:absolute;bottom:20px;right:10px;">
			<canvas id="compass" width="300" height="300">[No canvas support]</canvas>
		</div>
		<div style="text-align:center;position:absolute;top:0px;right:10px;">
			<canvas id="throttle" width="350" height="250"><div class="canvasfallback">[No canvas support]</div></canvas>
		</div>
		
		<div style="text-align:center;position:absolute;top:10px;left:10px;">
	        <canvas width="210" height="450" id="altitude">[No canvas support]</canvas>
	    </div>

	</div>
	<script>

	var min = 0;
	var max = 100;

	var throttle = new RGraph.Meter('throttle', min, max, 74);

	var grad1 = throttle.context.createRadialGradient(throttle.canvas.width / 2,throttle.canvas.height - 25,0,throttle.canvas.width / 2,throttle.canvas.height - 25,200);
	grad1.addColorStop(0, 'green');
	grad1.addColorStop(1, 'white');

	var grad2 = throttle.context.createRadialGradient(throttle.canvas.width / 2, throttle.canvas.height - 25,0,throttle.canvas.width / 2, throttle.canvas.height - 25,200);
	grad2.addColorStop(0, 'yellow');
	grad2.addColorStop(1, 'white');

	var grad3 = throttle.context.createRadialGradient(throttle.canvas.width / 2, throttle.canvas.height - 25,0,throttle.canvas.width / 2, throttle.canvas.height - 25,200);
	grad3.addColorStop(0, 'red');
	grad3.addColorStop(1, 'white');

	throttle.Set('chart.labels.position', 'inside');
	throttle.Set('chart.title', 'Throttle');
	throttle.Set('chart.title.vpos', 3);
	throttle.Set('chart.title.color', 'black');
	throttle.Set('chart.green.color', grad1);
	throttle.Set('chart.yellow.color', grad2);
	throttle.Set('chart.red.color', grad3);
	throttle.Set('chart.border', false);
	throttle.Set('chart.needle.linewidth', 5);
	throttle.Set('chart.needle.tail', true);
	throttle.Set('chart.tickmarks.big.num', 0);
	throttle.Set('chart.tickmarks.small.num', 0);
	throttle.Set('chart.segment.radius.start', 100);
	throttle.Set('chart.needle.radius', 80);
	throttle.Set('chart.needle.linewidth', 2);
	throttle.Set('chart.linewidth.segments', 15);
	throttle.Set('chart.strokestyle', 'white');
	throttle.Set('chart.text.size', 10);
	throttle.Draw();

	var odo2 = new RGraph.Odometer('compass', 0, 360, 0);
	odo2.Set('chart.needle.color', 'black');
	odo2.Set('chart.red.min', 359);
	odo2.Set('chart.green.max', 359);
	odo2.Set('chart.needle.tail', false);
	odo2.Set('chart.label.area', 35);
	odo2.Set('chart.border', RGraph.isOld() ? false : true);
	odo2.Set('chart.labels', ['N','NE','E','SE','S','SW','W','NW']);
	odo2.Set('chart.value.text', true);
	odo2.Set('chart.title', 'Heading');
	odo2.Set('chart.title.vpos', 0.4);
	odo2.Set('chart.value.units.post', '°');
	odo2.Set('chart.tickmarks', false);
	odo2.Set('chart.tickmarks.highlighted', true);
	odo2.Draw();
	
	var altitude = new RGraph.VProgress('altitude', 42, 100);
	altitude.Set('chart.colors', ['red']);
	altitude.Set('chart.margin', 5);
	altitude.Set('chart.tooltips.effect', 'fade');
	altitude.Set('chart.tickmarks', true);
	altitude.Set('chart.tickmarks.inner', true);
	altitude.Set('chart.tickmarks.color', '#333');
	altitude.Set('chart.tickmarks.zerostart', true);
	altitude.Set('chart.gutter.right', 125);
	altitude.Set('chart.scale.decimals', 1);
	altitude.Draw();
	</script>




	<script>
	var speed2 = new RGraph.Gauge('speed_gauge', 0,300,67);
	speed2.Set('chart.scale.decimals', 0);
	speed2.Set('chart.tickmarks.small', 50);
	speed2.Set('chart.tickmarks.big',10);
	speed2.Set('chart.title.top', 'Speed');
	speed2.Set('chart.title.top.bold', true);
	speed2.Set('chart.title.top.size', 10);
	speed2.Set('chart.title.bottom', 'kts');
	speed2.Set('chart.title.bottom.size', 10);
	speed2.Draw();


	/**
	* Only need to add the custom event listener once
	*/
	/*	speed1.canvas.onmousedown_rgraph = function (e)
	{
	var obj = RGraph.ObjectRegistry.getObjectByXY(e);
	if (obj) {
	obj.value = obj.getValue(e);
	RGraph.Effects.Gauge.Grow(obj);
	}
	}*/
	</script>        


	<script>
	function initGraphs()
	{
		window["rollgraph"] = new RGraph.Line('roll', roll_data);
		window["rollgraph"].Set('chart.background.barcolor1', 'white');
		window["rollgraph"].Set('chart.title.xaxis', 'Time >>>');
		window["rollgraph"].Set('chart.title.yaxis', 'Degrees');
		window["rollgraph"].Set('chart.title.vpos', 0.5);
		window["rollgraph"].Set('chart.title', 'Roll (náklon)');
		window["rollgraph"].Set('chart.title.yaxis.pos', 0.5);
		window["rollgraph"].Set('chart.title.xaxis.pos', 0.5);
		window["rollgraph"].Set('chart.filled', false);
		window["rollgraph"].Set('chart.colors', ['rgb(169, 222, 244)', 'red']);
		window["rollgraph"].Set('chart.linewidth', 1.5);
		window["rollgraph"].Set('chart.yaxispos', 'right');
		window["rollgraph"].Set('chart.xaxispos', 'center');
		window["rollgraph"].Set('chart.ymax',  90);
		window["rollgraph"].Set('chart.xticks', 25);

		window["speedgraph"] = new RGraph.Line('speed', speed_data);
		window["speedgraph"].Set('chart.background.barcolor1', 'white');
		window["speedgraph"].Set('chart.title.xaxis', 'Time >>>');
		window["speedgraph"].Set('chart.title.yaxis', 'kts');
		window["speedgraph"].Set('chart.title.vpos', 0.5);
		window["speedgraph"].Set('chart.title', 'Speed');
		window["speedgraph"].Set('chart.title.yaxis.pos', 0.5);
		window["speedgraph"].Set('chart.title.xaxis.pos', 0.5);
		window["speedgraph"].Set('chart.filled', false);
		window["speedgraph"].Set('chart.colors', ['rgb(169, 222, 244)', 'red']);
		window["speedgraph"].Set('chart.linewidth', 1.5);
		window["speedgraph"].Set('chart.yaxispos', 'right');
		window["speedgraph"].Set('chart.xaxispos', 'center');
		window["speedgraph"].Set('chart.ymax',  320);
		window["speedgraph"].Set('chart.xticks', 25);

		window["AOAgraph"] = new RGraph.Line('AOA', AOA_data);
		window["AOAgraph"].Set('chart.background.barcolor1', 'white');
		window["AOAgraph"].Set('chart.title.xaxis', 'Time >>>');
		window["AOAgraph"].Set('chart.title.yaxis', 'Degrees');
		window["AOAgraph"].Set('chart.title.vpos', 0.5);
		window["AOAgraph"].Set('chart.title', 'AOA');
		window["AOAgraph"].Set('chart.title.yaxis.pos', 0.5);
		window["AOAgraph"].Set('chart.title.xaxis.pos', 0.5);
		window["AOAgraph"].Set('chart.filled', false);
		window["AOAgraph"].Set('chart.colors', ['rgb(169, 222, 244)', 'red']);
		window["AOAgraph"].Set('chart.linewidth', 1.5);
		window["AOAgraph"].Set('chart.yaxispos', 'right');
		window["AOAgraph"].Set('chart.xaxispos', 'center');
		window["AOAgraph"].Set('chart.ymax',  30);
		window["AOAgraph"].Set('chart.xticks', 25);
	}

	function getGraph(graphname, id, storagename)
	{
		// After creating the chart, store it on the global window object
		if (!window[graphname]) {
			initGraphs();
		}

		return window[graphname];
	}
	function drawGraph (graf1)
	{
		values = graf1.split(",");
		if(parseInt(values[4]) != 1)
		{
			document.getElementById("num_updates1").innerHTML = parseInt(document.getElementById("num_updates1").innerHTML) + 1;
			document.getElementById("num_updates2").innerHTML = parseInt(document.getElementById("num_updates2").innerHTML) + 1;                
			document.getElementById("num_updates3").innerHTML = parseInt(document.getElementById("num_updates3").innerHTML) + 1;
			RGraph.Clear(document.getElementById("roll"));
			RGraph.Clear(document.getElementById("speed"));                
			RGraph.Clear(document.getElementById("AOA"));
			RGraph.Clear(document.getElementById("odo2"));
			RGraph.Clear(document.getElementById("speed2"));
			RGraph.Clear(document.getElementById("throttle"));
			RGraph.Clear(document.getElementById("altitude"));

			var roll_graph = getGraph("rollgraph", "roll", roll_data);
			roll_graph.Draw();

			var speed_graph = getGraph("speedgraph", "speed", speed_data);
			speed_graph.Draw();

			var AOA_graph = getGraph("AOAgraph", "AOA", AOA_data);
			AOA_graph.Draw();

			speed2.value = parseFloat(values[0]);
			speed2.Draw();	
			
			if(parseInt(values[1]) > 80)
			{
				altitude.Set('chart.colors', ['blue']);
			}
			else			
			if(parseInt(values[1]) > 15)
			{
				altitude.Set('chart.colors', ['green']);
			}
			else
			if(parseInt(values[1]) > 0)
			{
				altitude.Set('chart.colors', ['red']);
			}
			
			altitude.value = parseFloat(values[1]);
			altitude.Draw();

			speed_data.push(parseFloat(values[0]));
			if (speed_data.length > 250) {
				speed_data = RGraph.array_shift(speed_data);
			}

			roll_data.push(parseFloat(values[3]));
			if (roll_data.length > 250) {
				roll_data = RGraph.array_shift(roll_data);
			}

			AOA_data.push(parseFloat(values[2]));
			if (AOA_data.length > 250) {
				AOA_data = RGraph.array_shift(AOA_data);
			}

			odo2.value = parseInt(values[5]);
			odo2.Draw();

			throttle.value = parseFloat(values[6]*100);
			throttle.Draw();


			{
				if (document.all && RGraph.isIE8()) {
					alert('[MSIE] Sorry, Internet Explorer 8 is not fast enough to support animated charts');
				} else {
					window["rollgraph"].original_data[1] = roll_data;
					window["speedgraph"].original_data[1] = speed_data;
					window["AOAgraph"].original_data[1] = AOA_data;
					//setTimeout(drawGraph, 100, RGraph.random(1, 9));
				}
			}
		}
	}
	function initDraw (firstval)
	{
		speed_data  = [];
		roll_data   = [];
		AOA_data    = [];
		l   = 0; // The letter ell - NOT a one

		// Pre-pad the arrays with 250 null values
		for (var i=0; i<250; ++i) {
			speed_data.push(null);
			roll_data.push(null);
			AOA_data.push(null);
		}

		//drawGraph("1,2,3");
	}

	/**
	* Makes an AJAX call. It calls the given callback (a function) when ready
	* 
	* @param string   url      The URL to retrieve
	* @param function callback A function object that is called when the response is ready, there's an example below
	*                          called "myCallback".
	*/
	function AjaxCall (url, callback)
	{
		// Mozilla, Safari, ...
		if (window.XMLHttpRequest) {
			var httpRequest = new XMLHttpRequest();

			// MSIE
		} else if (window.ActiveXObject) {
			var httpRequest = new ActiveXObject("Microsoft.XMLHTTP");
		}

		httpRequest.onreadystatechange = callback;
		httpRequest.open('GET', url, true);
		httpRequest.send();
	}


	/**
	* This sample callback function is called when the data is ready (readyState=4)
	*/
	function myCallback ()
	{
		if (this.readyState == 4 && this.status == 200) {
			// Everything is good, the response is received
			//	    setTimeout(window.onload, 150); // 2000 milliseconds = 2 seconds
			//drawGraph(parseInt(this.responseText));
			drawGraph(this.responseText);
		}
	}
	</script>

	<script>
	function updateData()
	{
		AjaxCall('http://' + window.location.hostname + '/~toxygen/uav/roll.out', myCallback);
	}

	window.onload = function ()
	{
		initDraw(0);
		window.setInterval(function() { updateData(); }, 100);
	}


	</script>
</body>
</html>
